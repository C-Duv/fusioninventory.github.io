#  API-REST-collect

Protocol specification used to collect specific information on a machine.

##  ?action=getJob&machineid=$machineid

* action:getJob
* machineid: $machineid

###  serveur answer:

Server will return an array of job to process, a job is:
* a hash
* a mandatory "function" key
* an additional list of parameters

*getFromRegistry*

    [
       {
          "function" : "getFromRegistry",
          "64bit" : 0, // not implemented yet
          "path" : "HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Control/Session Manager",
          "uuid" : xxxx1
       }
    ]

path can finish with a wildcare, in such case, all the key/value of the current directory are returned.

*getFromWMI*

    [
       {
          "function" : "getFromWMI",
          "moniker" : "foobar" // default is winmgmts:{impersonationLevel=impersonate,(security)}!//./
          "class" : "Win32_Keyboard",
          "properties" : [ "Name", "Caption", "Manufacturer", "Description", "Layout" ],
          "uuid" : xxxx3
       }
    ]

*findFile*

    [
       {
          "function" : "findFile",
          "limit" : 5, # Number of entry to look for, default is 50
          "recursive" : 0,
          "filter" : // filter and its content is optional
              {
                          "regex" : "\d{4}\.bmp$",// regex done on the full path
                          "sizeEquals" : "445635",
                          "sizeGreater" : "432455",
                          "sizeLower" : "454545",
                          "checkSumSHA512" : "xxxx",
                          "checkSumSHA2" : "zzzzzz",
                          "name" : "toto",
                          "iname" : "ToTo", // case insensitive
                          "is_file" : 1,
                          "is_dir" : 0
              }
          ,
          "uuid" : xxxx3
       }
    ]

*runCommand*

    [
       {
          "function" : "runCommand",
          "command" : "route",
          "dir" : "c:/", # Where to run the command
          "uuid" : xxxx3,
          "filter" : { (optional)
              "firstMatch" : "(eth\d+)", // or (the first match for a regex)
              "firstLine" : "1", // or (the first line)
              "lineCount" : 1 // the number of lines
          }
       }
    ]

##  ?action=setAnswer&uuid=$uuid

the agent POST the answer in a JSON XML with this structure:


The answer structure is always a array of key/val hash.

###  getFromRegistry


* name1 : value1
* name2 : value2
* uuid : "foo"


###  getFromWMI

* propertyfoo : "bar",
* propertybar : "foo",
* uuid : "bibi1"

###  findFile


* path : "c:/somewhere/picture.bmp",
* uuid : "XXXX",
* size : 12345


###  runCommand

* output: "blabla",
* errorMsg: "an optional error message in english",
* uuid: "drf"
