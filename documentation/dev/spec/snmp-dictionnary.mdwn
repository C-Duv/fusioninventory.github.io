# SNMP Dictionnary

The SNMP dictionnary is a data structure of basic model-specific informations,
intended to identify a device during discovery phase.

It is stored as an XML file on the GLPI server, and transmitted to the
agent when needed.

## Format

Here is a simple DTD:

    <!ELEMENT SNMPDISCOVERY (DEVICE*)>
    <!ELEMENT DEVICE (SYSDESCR,TYPE,MODELSNMP?,MAC?,DYNMAC?,SERIAL?)>
    <!ELEMENT SYSDESCR (#PCDATA)>
    <!ELEMENT TYPE (2|3)>
    <!ELEMENT MODELSNMP (#PCDATA)>
    <!ELEMENT MAC (#PCDATA)>
    <!ELEMENT DYNMAC (#PCDATA)>
    <!ELEMENT SERIAL (#PCDATA)>

Here are the description for the various elements:

* SYSDESCR: SNMP sysdescr value of the described device
* TYPE: device type identifier (see [device types](../device-types) for details)
* MODELSNMP: SNMP description model identifier
* MAC:  SNMP oid of the device MAC address
* DYNMAC: ?
* SERIAL: SNMP oid of the device serial number

Problems:

* usage of a numeric value for the type is barely human-readable

## Communication

The agent stores a local copy of this dictionnary, and compares its md5sum
value with the one given by the server in its discovery request. When they
differs, the agent aborts the execution of the current task, with an error
status, and notify the server using a DICO element in its reply.

The next time the server send an discovery request to this agent, it
automatically send an updated version of the dictionnary, as a giant string
embedded in its discovery request, and the agent caches it locally.

Problems:

* the current dictionnary update requires two agent execution, server-side
  context, and is counter-intuitive for the user, whereas the server could
  immediatly send the updated dictionnary to the agent
  ([issue 1034](http://forge.fusioninventory.org/issues/1034))
* the server doesn't allow dictionnary retrieval outside of a scheduled
  discovery task, making usage of alternative tools difficult
  ([issue 1992](http://forge.fusioninventory.org/issues/1992))
* the double XML-in-XML encoding is unelegant, whereas the dictionnary could be
  sent either as an XML fragment, or as a separate download

## Local customisation

The dictionnary is stored as a XML file on the server, as
glpi/files/_plugins/fusioninventory/discovery.xml. This file is produced
dynamically from SNMP models database representation. Any modification of a
model in the database triggers its regeneration.

See [SNMP model specification](../snmp-model) for details about upgrade.

## Enhancement proposals

### Proposal 1

Implement [issue 1992](http://forge.fusioninventory.org/issues/1992), then
modify the agent to use this URL immediatly to retrieve the new
dictionnary if needed. This will solve the 3 different problems at once.
