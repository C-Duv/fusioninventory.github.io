# Network inventory protocol

## Server to agent message

### Specification

    <!ELEMENT REPLY (PROCESSNUMBER, OPTION)>
    <!ELEMENT PROCESSNUMBER (#PCDATA)>
    <!ELEMENT OPTION (NAME, PARAM, DEVICE+, AUTHENTICATION+, MODEL+)>
    <!ELEMENT NAME (#PCDATA)>

    <!ELEMENT PARAM EMPTY>
    <!ATTLIST PARAM CORE_QUERY CDATA>
    <!ATTLIST PARAM THREADS_QUERY CDATA>
    <!ATTLIST PARAM PID CDATA>

    <!ELEMENT DEVICE EMPTY>
    <!ATTLIST DEVICE TYPE (PRINTER|NETWORK|) #REQUIRED>
    <!ATTLIST DEVICE ID CDATA #REQUIRED>
    <!ATTLIST DEVICE IP CDATA #REQUIRED>
    <!ATTLIST DEVICE IP AUTHSNMP_ID #REQUIRED>
    <!ATTLIST DEVICE IP MODELSNMP_ID #REQUIRED>

    <!ELEMENT AUTHENTICATION EMPTY>
    <!ATTLIST AUTHENTICATION ID CDATA #REQUIRED>
    <!ATTLIST AUTHENTICATION VERSION CDATA #REQUIRED>
    <!ATTLIST AUTHENTICATION COMMUNITY CDATA #IMPLIED>
    <!ATTLIST AUTHENTICATION USERNAME CDATA #IMPLIED>
    <!ATTLIST AUTHENTICATION AUTHPROTOCOL CDATA #IMPLIED>
    <!ATTLIST AUTHENTICATION AUTHPASSPHRASE CDATA #IMPLIED>
    <!ATTLIST AUTHENTICATION PRIVHPROTOCOL CDATA #IMPLIED>
    <!ATTLIST AUTHENTICATION PRIVPASSPHRASE CDATA #IMPLIED>

    <!ELEMENT MODEL (GET+, WALK+)>
    <!ATTLIST MODEL ID CDATA #REQUIRED>
    <!ATTLIST MODEL NAME CDATA #REQUIRED>

    <!ELEMENT GET EMPTY>
    <!ATTLIST GET OBJECT CDATA #REQUIRED>
    <!ATTLIST GET OID CDATA #REQUIRED>
    <!ATTLIST GET VLAN CDATA #REQUIRED>
    <!ATTLIST GET VLAN LINK #REQUIRED>

    <!ELEMENT WALK EMPTY>
    <!ATTLIST GET OBJECT CDATA #REQUIRED>
    <!ATTLIST GET OID CDATA #REQUIRED>
    <!ATTLIST GET VLAN CDATA #REQUIRED>
    <!ATTLIST GET VLAN LINK #REQUIRED>

### Example

    <?xml version="1.0" encoding="UTF-8"?>
    <REPLY>
      <PROCESSNUMBER>1280265498/024</PROCESSNUMBER>
      <OPTION>
        <NAME>SNMPQUERY</NAME>
        <PARAM CORE_QUERY="1" THREADS_QUERY="4" PID="1280265498/024"/>
        <DEVICE TYPE="PRINTER" ID="72" IP="192.168.0.151" AUTHSNMP_ID="1" MODELSNMP_ID="196"/>
        <AUTHENTICATION ID="1" COMMUNITY="public" VERSION="1" USERNAME="" AUTHPROTOCOL="" AUTHPASSPHRASE="" PRIVPROTOCOL="" PRIVPASSPHRASE=""/>
        <MODEL ID="196" NAME="4675719">
          <GET OBJECT="name" OID=".1.3.6.1.2.1.1.5.0" VLAN="0" LINK="name"/>
          <WALK OBJECT="ifIndex" OID=".1.3.6.1.2.1.2.2.1.1" VLAN="0" LINK="ifIndex"/>
          <WALK OBJECT="ifaddr" OID=".1.3.6.1.2.1.4.20.1.2" VLAN="0" LINK="ifaddr"/>
          <GET OBJECT="informations" OID=".1.3.6.1.4.1.11.2.3.9.1.1.7.0" VLAN="0" LINK="informations"/>
        </MODEL>
      </OPTION>
    </REPLY>

## Agent to server message

### Specification

    <!ELEMENT REQUEST (CONTENT+ , DEVICEID, QUERY)>

    <!ELEMENT CONTENT (DEVICE*, MODULEVERSION, PROCESSNUMBER)>

    <!-- The devices list -->
    <!ELEMENT DEVICE (INFO , PORTS)>

    <!-- The device info -->
    <!ELEMENT INFO (COMMENTS, CPU, FIRMWARE, ID, IPS, LOCATION, MAC, MEMORY, MODEL, NAME, RAM, SERIAL, TYPE, UPTIME)>
    <!-- it's the sysdescr (string) -->
    <!ELEMENT COMMENTS (#PCDATA)>
    <!-- it's the cpu load in %, so from 0 to 100 (integer) -->
    <!ELEMENT CPU (#PCDATA)>
    <!-- it's the firmware (string) -->
    <!ELEMENT FIRMWARE (#PCDATA)>
    <!-- it's the id of the device in GLPI (integer) -->
    <!ELEMENT ID (#PCDATA)>

    <!-- The IPs list -->
    <!ELEMENT IPS (IP+)>
    <!-- it's the IP address, can be IP v4 and v6 (string) -->
    <!ELEMENT IP (#PCDATA)>

    <!-- it's the location (string) -->
    <!ELEMENT LOCATION (#PCDATA)>
    <!-- it's the mac address like 00:5e:03:a1:00:11 with letter always in lowercase (string) -->
    <!ELEMENT MAC (#PCDATA)>
    <!-- it's the storage in Mio (integer) -->
    <!ELEMENT MEMORY (#PCDATA)>
    <!-- it's the device model (string) -->
    <!ELEMENT MODEL (#PCDATA)>
    <!-- it's the device name (string) -->
    <!ELEMENT NAME (#PCDATA)>
    <!-- it's the volatile memory in Mio (integer) -->
    <!ELEMENT RAM (#PCDATA)>
    <!-- it's the device serial number (string) -->
    <!ELEMENT SERIAL (#PCDATA)>
    <!-- it's the type of device NETWORKING, PRINTER, COMPUTER or PHONE (constant) -->
    <!ELEMENT TYPE (#PCDATA)>
    <!-- it's the device uptime in format 8 days, 01:48:57.95 (string) -->
    <!ELEMENT UPTIME (#PCDATA)>

    <!-- The device ports list -->
    <!ELEMENT PORTS (PORT*)>

    <!-- One port -->
    <!ELEMENT PORT (CONNECTIONS?, AGGREGATE?, IFDESCR, IFINERRORS, IFINOCTETS, IFINTERNALSTATUS, IFLASTCHANGE, IFMTU, IFNAME, IFNUMBER, IFOUTERRORS, IFOUTOCTETS, IFSPEED, IFSTATUS, IFTYPE, MAC, TRUNK, VLANS?)>

    <!-- The port connections list -->
    <!ELEMENT CONNECTIONS (CDP?, CONNECTION*)>
    <!-- This port has a LLDP/CDP connection? (bool) -->
    <!ELEMENT CDP (#PCDATA)>

    <!-- One connection info of the port -->
    <!ELEMENT CONNECTION (MAC+ | (IFNUMBER?, SYSMAC?, IFDESCR?, IP?, SYSDESCR?, SYSNAME?))>
    <!-- it's the mac address of the remote device, like 00:5e:03:a1:00:11 with letter always in lowercase (string) -->
    <!ELEMENT MAC (#PCDATA)>
    <!-- it's the port number of remote device (integer) -->
    <!ELEMENT IFNUMBER (#PCDATA)>
    <!-- it's the mac address of the remote device, like 00:5e:03:a1:00:11 with letter always in lowercase. Differ of MAC because get with LLDP oids (string) -->
    <!ELEMENT SYSMAC (#PCDATA)>
    <!-- it's the port description of remote device (string) -->
    <!ELEMENT IFDESCR (#PCDATA)>
    <!-- it's the IP address of renote device, can be IP v4 and v6 (string) -->
    <!ELEMENT IP (#PCDATA)>
    <!-- it's the sysdescr of remote device (string) -->
    <!ELEMENT SYSDESCR (#PCDATA)>
    <!-- it's the name of remote device (string) -->
    <!ELEMENT SYSNAME (#PCDATA)>

    <!-- The aggregate port list, so the virtual port base on many physical ports -->
    <!ELEMENT AGGREGATE (PORT+)>
    <!-- it's the ifnumber of physical port (integer) -->
    <!ELEMENT PORT (#PCDATA)>

    <!-- it's the description of port (string) -->
    <!ELEMENT IFDESCR (#PCDATA)>
    <!-- it's the number of errors in input of port (integer) -->
    <!ELEMENT IFINERRORS (#PCDATA)>
    <!-- it's the number of bytes in input of port (integer) -->
    <!ELEMENT IFINOCTETS (#PCDATA)>
    <!-- it's the internal status of port (integer, is 1, 2 or 3) -->
    <!ELEMENT IFINTERNALSTATUS (#PCDATA)>
    <!-- it's the time since last change of port in format 8 days, 01:48:57.95 (string) -->
    <!ELEMENT IFLASTCHANGE (#PCDATA)>
    <!-- it's the MTU of port (integer) -->
    <!ELEMENT IFMTU (#PCDATA)>
    <!-- it's the name of port (string) -->
    <!ELEMENT IFNAME (#PCDATA)>
    <!-- it's the number of port (integer) -->
    <!ELEMENT IFNUMBER (#PCDATA)>
    <!-- it's the number of errors in output of port (integer) -->
    <!ELEMENT IFOUTERRORS (#PCDATA)>
    <!-- it's the number of bytes in output of port (integer) -->
    <!ELEMENT IFOUTOCTETS (#PCDATA)>
    <!-- it's the speed in bytes of port (integer) -->
    <!ELEMENT IFSPEED (#PCDATA)>
    <!-- it's the status of port, connected or not (bool) -->
    <!ELEMENT IFSTATUS (#PCDATA)>
    <!-- it's the type of port (integer) -->
    <!ELEMENT IFTYPE (#PCDATA)>
    <!-- it's the mac address of port, like 00:5e:03:a1:00:11 with letter always in lowercase (string) -->
    <!ELEMENT MAC (#PCDATA)>
    <!-- it's the trunk info of port, trunk/tagged or not (bool) -->
    <!ELEMENT TRUNK (#PCDATA)>

    <!-- The port VLAN list -->
    <!ELEMENT VLANS (VLAN+)>

    <!-- One VLAN -->
    <!ELEMENT VLAN (NAME, NUMBER)>
    <!-- it's the name of VLAN (string) -->
    <!ELEMENT NAME (#PCDATA)>
    <!-- it's the number of VLAN (integer) -->
    <!ELEMENT NUMBER (#PCDATA)>

    <!-- it's the version of netinventory agent module (string) -->
    <!ELEMENT MODULEVERSION (#PCDATA)>
    <!-- it's the id of the process sent by server (integer) -->
    <!ELEMENT PROCESSNUMBER (#PCDATA)>

    <!ELEMENT DEVICEID (#PCDATA)>

    <!ELEMENT QUERY (#PCDATA)>
