# Network inventory protocol

## Server to agent message

### Specification

    <!ELEMENT REPLY (PROCESSNUMBER, OPTION)>
    <!ELEMENT PROCESSNUMBER (#PCDATA)>
    <!ELEMENT OPTION (NAME, PARAM, DEVICE+, AUTHENTICATION+)>
    <!ELEMENT NAME (#PCDATA)>

    <!ELEMENT PARAM EMPTY>
    <!ATTLIST PARAM THREADS_QUERY CDATA "1">
    <!ATTLIST PARAM PID CDATA #REQUIRED>

    <!ELEMENT DEVICE EMPTY>
    <!ATTLIST DEVICE TYPE (COMPUTER|PRINTER|NETWORKING|STORAGE|POWER|PHONE|VIDEO) #REQUIRED>
    <!ATTLIST DEVICE ID CDATA #REQUIRED>
    <!ATTLIST DEVICE IP CDATA #REQUIRED>
    <!ATTLIST DEVICE IP AUTHSNMP_ID #REQUIRED>

    <!ELEMENT AUTHENTICATION EMPTY>
    <!ATTLIST AUTHENTICATION ID CDATA #REQUIRED>
    <!ATTLIST AUTHENTICATION VERSION CDATA #REQUIRED>
    <!ATTLIST AUTHENTICATION COMMUNITY CDATA #IMPLIED>
    <!ATTLIST AUTHENTICATION USERNAME CDATA #IMPLIED>
    <!ATTLIST AUTHENTICATION AUTHPROTOCOL CDATA #IMPLIED>
    <!ATTLIST AUTHENTICATION AUTHPASSPHRASE CDATA #IMPLIED>
    <!ATTLIST AUTHENTICATION PRIVHPROTOCOL CDATA #IMPLIED>
    <!ATTLIST AUTHENTICATION PRIVPASSPHRASE CDATA #IMPLIED>

### Example

    <?xml version="1.0" encoding="UTF-8"?>
    <REPLY>
      <PROCESSNUMBER>1280265498/024</PROCESSNUMBER>
      <OPTION>
        <NAME>SNMPQUERY</NAME>
        <PARAM THREADS_QUERY="4" PID="1280265498/024"/>
        <DEVICE TYPE="PRINTER" ID="72" IP="192.168.0.151" AUTHSNMP_ID="1"/>
        <AUTHENTICATION ID="1" COMMUNITY="public" VERSION="1" USERNAME="" AUTHPROTOCOL="" AUTHPASSPHRASE="" PRIVPROTOCOL="" PRIVPASSPHRASE=""/>
      </OPTION>
    </REPLY>

## Agent to server message

### Specification

    <!ELEMENT REQUEST (CONTENT+, DEVICEID, QUERY)>

    <!ELEMENT CONTENT (DEVICE*, MODULEVERSION, PROCESSNUMBER)>

    <!-- a device -->
    <!ELEMENT DEVICE (INFO, PORTS)>

    <!-- generic information -->
    <!ELEMENT INFO (COMMENTS, CPU, FIRMWARE, ID, IPS, LOCATION, MAC, MEMORY, MODEL, NAME, RAM, SERIAL, TYPE, UPTIME)>
    <!-- sysdescr (string) -->
    <!ELEMENT COMMENTS (#PCDATA)>
    <!-- CPU load in % (integer) -->
    <!ELEMENT CPU (#PCDATA)>
    <!-- firmware (string) -->
    <!ELEMENT FIRMWARE (#PCDATA)>
    <!-- device ID in GLPI (integer) -->
    <!ELEMENT ID (#PCDATA)>

    <!-- IP addresses list -->
    <!ELEMENT IPS (IP+)>
    <!-- an IP address, either IPv4 or IPv6 (string) -->
    <!ELEMENT IP (#PCDATA)>

    <!-- location (string) -->
    <!ELEMENT LOCATION (#PCDATA)>
    <!-- mac address (string) -->
    <!ELEMENT MAC (#PCDATA)>
    <!-- storage in Mio (integer) -->
    <!ELEMENT MEMORY (#PCDATA)>
    <!-- device model (string) -->
    <!ELEMENT MODEL (#PCDATA)>
    <!-- device name (string) -->
    <!ELEMENT NAME (#PCDATA)>
    <!-- volatile memory in Mio (integer) -->
    <!ELEMENT RAM (#PCDATA)>
    <!-- serial number (string) -->
    <!ELEMENT SERIAL (#PCDATA)>
    <!-- device type (constant) -->
    <!ELEMENT TYPE (COMPUTER|PRINTER|NETWORKING|STORAGE|POWER|PHONE|VIDEO)>
    <!-- uptime (string with X days, HH:MM::SS format) -->
    <!ELEMENT UPTIME (#PCDATA)>

    <!-- ports list -->
    <!ELEMENT PORTS (PORT*)>

    <!-- a port -->
    <!ELEMENT PORT (CONNECTIONS?, AGGREGATE?, IFDESCR, IFINERRORS, IFINOCTETS, IFINTERNALSTATUS, IFLASTCHANGE, IFMTU, IFNAME, IFNUMBER, IFOUTERRORS, IFOUTOCTETS, IFSPEED, IFSTATUS, IFTYPE, MAC, TRUNK, VLANS?)>

    <!-- connections list -->
    <!ELEMENT CONNECTIONS (CDP?, CONNECTION*)>
    <!-- LLDP/CDP connection? (bool) -->
    <!ELEMENT CDP (#PCDATA)>

    <!-- a connection -->
    <!ELEMENT CONNECTION (MAC+ | (IFNUMBER?, SYSMAC?, IFDESCR?, IP?, SYSDESCR?, SYSNAME?))>
    <!-- mac address of the remote device (string) -->
    <!ELEMENT MAC (#PCDATA)>
    <!-- interface ID of the remote device (integer) -->
    <!ELEMENT IFNUMBER (#PCDATA)>
    <!-- mac address of the remote device (string) Differ of MAC because get with LLDP oids (string) -->
    <!ELEMENT SYSMAC (#PCDATA)>
    <!-- port description of the remote device (string) -->
    <!ELEMENT IFDESCR (#PCDATA)>
    <!-- IP address of the remote device, IPv4 or IPv6 (string) -->
    <!ELEMENT IP (#PCDATA)>
    <!-- sysdescr of the remote device (string) -->
    <!ELEMENT SYSDESCR (#PCDATA)>
    <!-- name of the remote device (string) -->
    <!ELEMENT SYSNAME (#PCDATA)>

    <!-- aggregate port list, so the virtual port base on many physical ports -->
    <!ELEMENT AGGREGATE (PORT+)>
    <!-- interface number of physical port (integer) -->
    <!ELEMENT PORT (#PCDATA)>

    <!-- description of port (string) -->
    <!ELEMENT IFDESCR (#PCDATA)>
    <!-- input errors number (integer) -->
    <!ELEMENT IFINERRORS (#PCDATA)>
    <!-- input bytes number (integer) -->
    <!ELEMENT IFINOCTETS (#PCDATA)>
    <!-- internal status (constant) -->
    <!ELEMENT IFINTERNALSTATUS (1|2|3)>
    <!-- time since last status change (string, X days, HH:MM::SS format) -->
    <!ELEMENT IFLASTCHANGE (#PCDATA)>
    <!-- MTU (integer) -->
    <!ELEMENT IFMTU (#PCDATA)>
    <!-- name (string) -->
    <!ELEMENT IFNAME (#PCDATA)>
    <!-- interface ID (integer) -->
    <!ELEMENT IFNUMBER (#PCDATA)>
    <!-- output errors number (integer) -->
    <!ELEMENT IFOUTERRORS (#PCDATA)>
    <!-- output bytes number (integer) -->
    <!ELEMENT IFOUTOCTETS (#PCDATA)>
    <!-- speed in bytes (integer) -->
    <!ELEMENT IFSPEED (#PCDATA)>
    <!-- status (constant) -->
    <!ELEMENT IFSTATUS (1|2)>
    <!-- port type (integer) -->
    <!ELEMENT IFTYPE (#PCDATA)>
    <!-- mac address (string) -->
    <!ELEMENT MAC (#PCDATA)>
    <!-- trunk port flag (constant) -->
    <!ELEMENT TRUNK (0|1)>

    <!-- VLANs list -->
    <!ELEMENT VLANS (VLAN+)>

    <!-- a VLAN -->
    <!ELEMENT VLAN (NAME, NUMBER)>
    <!-- VLAN name (string) -->
    <!ELEMENT NAME (#PCDATA)>
    <!-- VLAN ID (integer) -->
    <!ELEMENT NUMBER (#PCDATA)>

    <!-- netinventory module version(string) -->
    <!ELEMENT MODULEVERSION (#PCDATA)>
    <!-- server process ID (integer) -->
    <!ELEMENT PROCESSNUMBER (#PCDATA)>

    <!-- agent ID (string) -->
    <!ELEMENT DEVICEID (#PCDATA)>
    <!-- message type ("SNMPQUERY") -->
    <!ELEMENT QUERY (#PCDATA)>

### Example
    <?xml version="1.0" encoding="UTF-8" ?>
    <REQUEST>
      <CONTENT>
	<DEVICE>
	  <INFO>
	    <COMMENTS>ProCurve J8697A Switch 5406zl, revision K.15.04.0015m, ROM K.15.28 (/ws/swbuildm/ec_rel_charleston_qaoff/code/build/btm(ec_rel_</COMMENTS>
	    <CONTACT>systeme@example.com</CONTACT>
	    <ID>1</ID>
	    <IPS>
	      <IP>127.0.0.1</IP>
	      <IP>192.168.227.246</IP>
	    </IPS>
	    <LOCATION>datacenter</LOCATION>
	    <MAC>00:18:71:c1:e0:00</MAC>
	    <MANUFACTURER>Hewlett-Packard</MANUFACTURER>
	    <MODEL>ProCurve 5406zl (J8697A)</MODEL>
	    <NAME>thisisdog CR2</NAME>
	    <SERIAL>SG707SU03Y</SERIAL>
	    <TYPE>NETWORKING</TYPE>
	    <UPTIME>(293555959) 33 days, 23:25:59.59</UPTIME>
	  </INFO>
	  <PORTS>
	    <PORT>
	      <CONNECTIONS>
		<CDP>1</CDP>
		<CONNECTION>
		  <IFDESCR>141</IFDESCR>
		  <IP>172.31.196.140</IP>
		  <MODEL>ProCurve J8697A Switch 5406zl, revision K.15.04.0015m, ROM K.15.28 (/ws/swbuildm/ec_rel_charleston_qaoff/code/build/btm(ec_rel_charleston_qaoff))</MODEL>
		  <SYSDESCR>ProCurve J8697A Switch 5406zl, revision K.15.04.0015m, ROM K.15.28 (/ws/swbuildm/ec_rel_charleston_qaoff/code/build/btm(ec_rel_charleston_qaoff))</SYSDESCR>
		  <SYSNAME>0x0019BB010B00</SYSNAME>
		</CONNECTION>
	      </CONNECTIONS>
	      <IFDESCR>A1</IFDESCR>
	      <IFINERRORS>0</IFINERRORS>
	      <IFINOCTETS>2281257823</IFINOCTETS>
	      <IFINTERNALSTATUS>1</IFINTERNALSTATUS>
	      <IFLASTCHANGE>(137791) 0:22:57.91</IFLASTCHANGE>
	      <IFMTU>1500</IFMTU>
	      <IFNAME>A1</IFNAME>
	      <IFNUMBER>1</IFNUMBER>
	      <IFOUTERRORS>0</IFOUTERRORS>
	      <IFOUTOCTETS>1349379502</IFOUTOCTETS>
	      <IFPORTDUPLEX>3</IFPORTDUPLEX>
	      <IFSPEED>1000000000</IFSPEED>
	      <IFSTATUS>1</IFSTATUS>
	      <IFTYPE>6</IFTYPE>
	      <MAC>00:18:71:c1:f0:ff</MAC>
	    </PORT>
	    <PORT>
	      <CONNECTIONS>
		<CDP>1</CDP>
		<CONNECTION>
		  <IFDESCR>143</IFDESCR>
		  <IP>172.31.196.140</IP>
		  <MODEL>ProCurve J8697A Switch 5406zl, revision K.15.04.0015m, ROM K.15.28 (/ws/swbuildm/ec_rel_charleston_qaoff/code/build/btm(ec_rel_charleston_qaoff))</MODEL>
		  <SYSDESCR>ProCurve J8697A Switch 5406zl, revision K.15.04.0015m, ROM K.15.28 (/ws/swbuildm/ec_rel_charleston_qaoff/code/build/btm(ec_rel_charleston_qaoff))</SYSDESCR>
		  <SYSNAME>0x0019BB010B00</SYSNAME>
		</CONNECTION>
	      </CONNECTIONS>
	      <IFDESCR>A2</IFDESCR>
	      <IFINERRORS>0</IFINERRORS>
	      <IFINOCTETS>1790849661</IFINOCTETS>
	      <IFINTERNALSTATUS>1</IFINTERNALSTATUS>
	      <IFLASTCHANGE>(137791) 0:22:57.91</IFLASTCHANGE>
	      <IFMTU>1500</IFMTU>
	      <IFNAME>A2</IFNAME>
	      <IFNUMBER>2</IFNUMBER>
	      <IFOUTERRORS>0</IFOUTERRORS>
	      <IFOUTOCTETS>351638347</IFOUTOCTETS>
	      <IFPORTDUPLEX>3</IFPORTDUPLEX>
	      <IFSPEED>1000000000</IFSPEED>
	      <IFSTATUS>1</IFSTATUS>
	      <IFTYPE>6</IFTYPE>
	      <MAC>00:18:71:c1:f0:fe</MAC>
	    </PORT>
	  </PORTS>
	  ...
	</DEVICE>
	<MODULEVERSION>2.3.9901</MODULEVERSION>
	<PROCESSNUMBER>1</PROCESSNUMBER>
      </CONTENT>
      <DEVICEID>beria-2012-08-02-20-50-16</DEVICEID>
      <QUERY>SNMPQUERY</QUERY>
    </REQUEST>
